<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Advanced Traffic Control Simulation</title>
  <style>
    :root {
      --red-light: #ff4757;
      --yellow-light: #ffa502;
      --green-light: #2ed573;
      --dark-bg: #2f3542;
      --light-bg: #f1f2f6;
      --road-color: #57606f;
      --car-color: #ff7f50;
      --pedestrian-color: #70a1ff;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #1e3c72, #2a5298);
      color: white;
      text-align: center;
      min-height: 100vh;
      padding: 20px;
      overflow-x: hidden;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    h1 {
      font-size: 2.5rem;
      margin-bottom: 20px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      background: rgba(0, 0, 0, 0.2);
      padding: 15px;
      border-radius: 10px;
      display: inline-block;
    }

    .simulation-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 30px;
      margin-top: 30px;
    }

    .intersection-container {
      flex: 1;
      min-width: 300px;
      max-width: 500px;
    }

    .info-panel {
      flex: 1;
      min-width: 300px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      padding: 20px;
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
    }

    .intersection {
      position: relative;
      width: 100%;
      height: 400px;
      background: var(--road-color);
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    .road {
      position: absolute;
      background: #747d8c;
    }

    .road-horizontal {
      width: 100%;
      height: 80px;
      top: 50%;
      transform: translateY(-50%);
    }

    .road-vertical {
      width: 80px;
      height: 100%;
      left: 50%;
      transform: translateX(-50%);
    }

    .road-markings {
      position: absolute;
      background: white;
    }

    .road-markings.horizontal {
      width: 100%;
      height: 5px;
      top: 50%;
      transform: translateY(-50%);
    }

    .road-markings.vertical {
      width: 5px;
      height: 100%;
      left: 50%;
      transform: translateX(-50%);
    }

    .dashed-line {
      position: absolute;
      background: repeating-linear-gradient(
        to right,
        white,
        white 20px,
        transparent 20px,
        transparent 40px
      );
    }

    .dashed-line.horizontal {
      width: 100%;
      height: 5px;
      top: 50%;
      transform: translateY(-50%);
    }

    .dashed-line.vertical {
      width: 5px;
      height: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: repeating-linear-gradient(
        to bottom,
        white,
        white 20px,
        transparent 20px,
        transparent 40px
      );
    }

    .traffic-lamp {
      position: absolute;
      width: 90px;
      background: var(--dark-bg);
      padding: 10px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
      z-index: 10;
    }

    .traffic-lamp.north {
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
    }

    .traffic-lamp.south {
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
    }

    .traffic-lamp.east {
      top: 50%;
      right: 20px;
      transform: translateY(-50%);
    }

    .traffic-lamp.west {
      top: 50%;
      left: 20px;
      transform: translateY(-50%);
    }

    .lamp-housing {
      width: 70px;
      height: 180px;
      background: #1e272e;
      border-radius: 10px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      justify-content: space-around;
      align-items: center;
      padding: 10px 0;
    }

    .light {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.1);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .light::after {
      content: '';
      position: absolute;
      top: 10%;
      left: 10%;
      width: 80%;
      height: 80%;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .light.red.on {
      background: var(--red-light);
      box-shadow: 0 0 20px var(--red-light);
    }

    .light.yellow.on {
      background: var(--yellow-light);
      box-shadow: 0 0 20px var(--yellow-light);
    }

    .light.green.on {
      background: var(--green-light);
      box-shadow: 0 0 20px var(--green-light);
    }

    .light.on::after {
      opacity: 1;
    }

    .timer {
      font-size: 24px;
      font-weight: bold;
      margin-top: 10px;
      color: white;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
    }

    .label {
      margin-top: 5px;
      font-weight: bold;
      color: white;
    }

    .car {
      position: absolute;
      width: 50px;
      height: 25px;
      background: var(--car-color);
      border-radius: 5px;
      z-index: 5;
      transition: all 0.1s linear;
      box-shadow: 0 3px 5px rgba(0, 0, 0, 0.3);
    }

    .car::before {
      content: '';
      position: absolute;
      width: 15px;
      height: 15px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 3px;
    }

    .car.north {
      top: 100%;
      left: 50%;
      transform: translateX(-50%) rotate(180deg);
    }

    .car.north::before {
      top: 5px;
      left: 5px;
    }

    .car.south {
      top: -25px;
      left: 50%;
      transform: translateX(-50%);
    }

    .car.south::before {
      bottom: 5px;
      right: 5px;
    }

    .car.east {
      left: -50px;
      top: 50%;
      transform: translateY(-50%) rotate(270deg);
    }

    .car.east::before {
      top: 5px;
      right: 5px;
    }

    .car.west {
      right: -50px;
      top: 50%;
      transform: translateY(-50%) rotate(90deg);
    }

    .car.west::before {
      bottom: 5px;
      left: 5px;
    }

    .car.moving {
      animation-duration: 3s;
      animation-timing-function: linear;
      animation-fill-mode: forwards;
    }

    .car.north.moving {
      animation-name: moveNorth;
    }

    .car.south.moving {
      animation-name: moveSouth;
    }

    .car.east.moving {
      animation-name: moveEast;
    }

    .car.west.moving {
      animation-name: moveWest;
    }

    @keyframes moveNorth {
      from { top: 100%; }
      to { top: -25px; }
    }

    @keyframes moveSouth {
      from { top: -25px; }
      to { top: 100%; }
    }

    @keyframes moveEast {
      from { left: -50px; }
      to { left: 100%; }
    }

    @keyframes moveWest {
      from { right: -50px; }
      to { right: 100%; }
    }

    .pedestrian {
      position: absolute;
      width: 15px;
      height: 30px;
      background: var(--pedestrian-color);
      border-radius: 3px;
      z-index: 5;
      opacity: 0;
      transition: opacity 0.5s ease;
    }

    .pedestrian.active {
      opacity: 1;
    }

    .pedestrian.north {
      top: 20px;
      left: 60%;
    }

    .pedestrian.south {
      bottom: 20px;
      left: 40%;
    }

    .pedestrian.east {
      top: 60%;
      right: 20px;
    }

    .pedestrian.west {
      top: 40%;
      left: 20px;
    }

    .controls {
      margin-top: 30px;
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 15px;
    }

    button {
      padding: 12px 25px;
      border: none;
      border-radius: 50px;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      font-size: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    button:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
    }

    button:active {
      transform: translateY(1px);
    }

    #startBtn {
      background: linear-gradient(135deg, #00b894, #00a085);
    }

    #stopBtn {
      background: linear-gradient(135deg, #ff7675, #e84393);
    }

    #pedBtn {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
    }

    #resetBtn {
      background: linear-gradient(135deg, #a29bfe, #6c5ce7);
    }

    .info-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-top: 20px;
    }

    .info-card {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      padding: 15px;
      text-align: left;
    }

    .info-card h3 {
      margin-bottom: 10px;
      font-size: 1.1rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      padding-bottom: 5px;
    }

    .status-indicator {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 8px;
    }

    .status-running {
      background: var(--green-light);
      box-shadow: 0 0 8px var(--green-light);
    }

    .status-stopped {
      background: var(--red-light);
      box-shadow: 0 0 8px var(--red-light);
    }

    .status-pedestrian {
      background: var(--yellow-light);
      box-shadow: 0 0 8px var(--yellow-light);
    }

    .stats {
      margin-top: 20px;
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap;
      gap: 15px;
    }

    .stat-item {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      padding: 15px;
      min-width: 120px;
    }

    .stat-value {
      font-size: 2rem;
      font-weight: bold;
      margin: 5px 0;
    }

    .stat-label {
      font-size: 0.9rem;
      opacity: 0.8;
    }

    .settings {
      margin-top: 20px;
      text-align: left;
    }

    .setting-item {
      margin-bottom: 15px;
    }

    .setting-item label {
      display: block;
      margin-bottom: 5px;
    }

    .setting-item input {
      width: 100%;
      padding: 8px;
      border-radius: 5px;
      border: none;
      background: rgba(255, 255, 255, 0.1);
      color: white;
    }

    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(255, 255, 255, 0.9);
      color: #2d3436;
      padding: 15px 20px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      transform: translateX(150%);
      transition: transform 0.5s ease;
      z-index: 100;
    }

    .notification.show {
      transform: translateX(0);
    }

    @media (max-width: 768px) {
      .simulation-container {
        flex-direction: column;
      }
      
      .info-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üö¶ Advanced Traffic Control Simulation</h1>

    <div class="simulation-container">
      <div class="intersection-container">
        <div class="intersection">
          <!-- Roads -->
          <div class="road road-horizontal"></div>
          <div class="road road-vertical"></div>
          
          <!-- Road Markings -->
          <div class="road-markings horizontal"></div>
          <div class="road-markings vertical"></div>
          <div class="dashed-line horizontal"></div>
          <div class="dashed-line vertical"></div>
          
          <!-- Traffic Lamps -->
          <div class="traffic-lamp north">
            <div class="lamp-housing">
              <div class="light red"></div>
              <div class="light yellow"></div>
              <div class="light green"></div>
            </div>
            <div class="timer" id="timer-north">0</div>
            <div class="label">North</div>
          </div>

          <div class="traffic-lamp south">
            <div class="lamp-housing">
              <div class="light red"></div>
              <div class="light yellow"></div>
              <div class="light green"></div>
            </div>
            <div class="timer" id="timer-south">0</div>
            <div class="label">South</div>
          </div>

          <div class="traffic-lamp east">
            <div class="lamp-housing">
              <div class="light red"></div>
              <div class="light yellow"></div>
              <div class="light green"></div>
            </div>
            <div class="timer" id="timer-east">0</div>
            <div class="label">East</div>
          </div>

          <div class="traffic-lamp west">
            <div class="lamp-housing">
              <div class="light red"></div>
              <div class="light yellow"></div>
              <div class="light green"></div>
            </div>
            <div class="timer" id="timer-west">0</div>
            <div class="label">West</div>
          </div>
          
          <!-- Cars -->
          <div class="car north" id="car-north"></div>
          <div class="car south" id="car-south"></div>
          <div class="car east" id="car-east"></div>
          <div class="car west" id="car-west"></div>
          
          <!-- Pedestrians -->
          <div class="pedestrian north" id="ped-north"></div>
          <div class="pedestrian south" id="ped-south"></div>
          <div class="pedestrian east" id="ped-east"></div>
          <div class="pedestrian west" id="ped-west"></div>
        </div>

        <div class="controls">
          <button id="startBtn">
            <span>‚ñ∂</span> Start
          </button>
          <button id="stopBtn">
            <span>‚èπ</span> Stop
          </button>
          <button id="pedBtn">
            <span>üö∂</span> Pedestrian
          </button>
          <button id="resetBtn">
            <span>üîÑ</span> Reset
          </button>
        </div>
      </div>

      <div class="info-panel">
        <h2>Simulation Info</h2>
        
        <div class="info-grid">
          <div class="info-card">
            <h3>Status</h3>
            <p>
              <span class="status-indicator" id="status-indicator"></span>
              <span id="mode">Stopped</span>
            </p>
            <p>Current: <span id="current">‚Äî</span></p>
          </div>
          
          <div class="info-card">
            <h3>Next Change</h3>
            <p id="next-change">‚Äî</p>
          </div>
        </div>
        
        <div class="stats">
          <div class="stat-item">
            <div class="stat-value" id="cars-passed">0</div>
            <div class="stat-label">Cars Passed</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="pedestrians-crossed">0</div>
            <div class="stat-label">Pedestrians</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="cycle-count">0</div>
            <div class="stat-label">Cycles</div>
          </div>
        </div>
        
        <div class="settings">
          <h3>Settings</h3>
          <div class="setting-item">
            <label for="green-time">Green Light Duration (seconds)</label>
            <input type="number" id="green-time" min="3" max="20" value="5">
          </div>
          <div class="setting-item">
            <label for="yellow-time">Yellow Light Duration (seconds)</label>
            <input type="number" id="yellow-time" min="1" max="5" value="2">
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="notification" id="notification">
    Pedestrian crossing activated!
  </div>

  <script>
    // DOM Elements
    const lamps = {
      north: document.querySelector('#lamp-north'),
      south: document.querySelector('#lamp-south'),
      east: document.querySelector('#lamp-east'),
      west: document.querySelector('#lamp-west')
    };

    const timers = {
      north: document.querySelector('#timer-north'),
      south: document.querySelector('#timer-south'),
      east: document.querySelector('#timer-east'),
      west: document.querySelector('#timer-west')
    };

    const cars = {
      north: document.querySelector('#car-north'),
      south: document.querySelector('#car-south'),
      east: document.querySelector('#car-east'),
      west: document.querySelector('#car-west')
    };

    const pedestrians = {
      north: document.querySelector('#ped-north'),
      south: document.querySelector('#ped-south'),
      east: document.querySelector('#ped-east'),
      west: document.querySelector('#ped-west')
    };

    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const pedBtn = document.getElementById('pedBtn');
    const resetBtn = document.getElementById('resetBtn');
    const modeEl = document.getElementById('mode');
    const currentEl = document.getElementById('current');
    const nextChangeEl = document.getElementById('next-change');
    const statusIndicator = document.getElementById('status-indicator');
    const notification = document.getElementById('notification');
    
    // Stats elements
    const carsPassedEl = document.getElementById('cars-passed');
    const pedestriansCrossedEl = document.getElementById('pedestrians-crossed');
    const cycleCountEl = document.getElementById('cycle-count');
    
    // Settings elements
    const greenTimeInput = document.getElementById('green-time');
    const yellowTimeInput = document.getElementById('yellow-time');

    // Simulation state
    let running = false;
    let pedestrianRequested = false;
    let currentPhase = null;
    let cycleCount = 0;
    let carsPassed = 0;
    let pedestriansCrossed = 0;
    
    // Default timing values
    let GREEN_TIME = 5;
    let YELLOW_TIME = 2;

    // Update timing values when settings change
    greenTimeInput.addEventListener('change', () => {
      GREEN_TIME = parseInt(greenTimeInput.value);
    });

    yellowTimeInput.addEventListener('change', () => {
      YELLOW_TIME = parseInt(yellowTimeInput.value);
    });

    // Helper functions
    function setLamp(dir, color) {
      const el = lamps[dir];
      el.querySelectorAll('.light').forEach(l => l.classList.remove('on'));
      if (color) {
        el.querySelector(.light.${color}).classList.add('on');
      }
    }

    function allRed() {
      Object.keys(lamps).forEach(d => setLamp(d, 'red'));
      Object.values(timers).forEach(t => (t.textContent = 0));
    }

    function updateStatus(status, text) {
      modeEl.textContent = text;
      statusIndicator.className = 'status-indicator';
      
      if (status === 'running') {
        statusIndicator.classList.add('status-running');
      } else if (status === 'stopped') {
        statusIndicator.classList.add('status-stopped');
      } else if (status === 'pedestrian') {
        statusIndicator.classList.add('status-pedestrian');
      }
    }

    function showNotification(message) {
      notification.textContent = message;
      notification.classList.add('show');
      
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }

    function sleep(ms) {
      return new Promise(res => setTimeout(res, ms));
    }

    function opposite(dir) {
      if (dir === 'north') return 'south';
      if (dir === 'south') return 'north';
      if (dir === 'east') return 'west';
      if (dir === 'west') return 'east';
    }

    async function countDown(dir, seconds) {
      for (let i = seconds; i >= 0; i--) {
        if (!running) break;
        
        timers[dir].textContent = i;
        timers[opposite(dir)].textContent = i;
        
        // Update next change display
        nextChangeEl.textContent = ${i} seconds;
        
        await sleep(1000);
      }
    }

    function moveCar(dir) {
      const car = cars[dir];
      car.classList.add('moving');
      
      // Reset animation after it completes
      setTimeout(() => {
        car.classList.remove('moving');
      }, 3000);
      
      // Increment car counter
      carsPassed++;
      carsPassedEl.textContent = carsPassed;
    }

    function showPedestrian(dir) {
      const ped = pedestrians[dir];
      ped.classList.add('active');
      
      setTimeout(() => {
        ped.classList.remove('active');
      }, 3000);
      
      // Increment pedestrian counter
      pedestriansCrossed++;
      pedestriansCrossedEl.textContent = pedestriansCrossed;
    }

    async function greenCycle(dir1, dir2) {
      currentPhase = ${dir1}-${dir2};
      updateStatus('running', 'Traffic Flow');
      currentEl.textContent = ${dir1.toUpperCase()} - ${dir2.toUpperCase()} Green;

      // Set lights to green for the active directions
      setLamp(dir1, 'green');
      setLamp(dir2, 'green');
      setLamp(opposite(dir1), 'red');
      setLamp(opposite(dir2), 'red');

      // Start car movement
      moveCar(dir1);
      moveCar(dir2);

      // Count down green time
      await countDown(dir1, GREEN_TIME);
      if (!running) return;

      // Switch to yellow
      setLamp(dir1, 'yellow');
      setLamp(dir2, 'yellow');
      await countDown(dir1, YELLOW_TIME);
      if (!running) return;

      // Set to red
      setLamp(dir1, 'red');
      setLamp(dir2, 'red');
    }

    async function flashPedestrian() {
      updateStatus('pedestrian', 'Pedestrian Crossing');
      showNotification('Pedestrian crossing activated!');
      
      // Show pedestrians
      Object.values(pedestrians).forEach(ped => ped.classList.add('active'));
      
      // Set all lights to green for pedestrian crossing
      Object.keys(lamps).forEach(d => setLamp(d, 'green'));
      await sleep(2000);
      
      // Set all lights to blinking red
      Object.keys(lamps).forEach(d => {
        setLamp(d, 'red');
        // Add blinking effect
        const redLight = lamps[d].querySelector('.light.red');
        let blinkCount = 0;
        const blinkInterval = setInterval(() => {
          redLight.classList.toggle('on');
          blinkCount++;
          if (blinkCount >= 6) {
            clearInterval(blinkInterval);
            redLight.classList.add('on');
          }
        }, 500);
      });
      
      await sleep(3000);
      
      // Hide pedestrians
      Object.values(pedestrians).forEach(ped => ped.classList.remove('active'));
      
      updateStatus('running', 'Traffic Flow');
    }

    async function runTraffic() {
      while (running) {
        // North-South cycle
        await greenCycle('north', 'south');
        if (!running) break;

        // Check for pedestrian request
        if (pedestrianRequested) {
          pedestrianRequested = false;
          await flashPedestrian();
          if (!running) break;
        }

        // East-West cycle
        await greenCycle('east', 'west');
        if (!running) break;

        // Check for pedestrian request
        if (pedestrianRequested) {
          pedestrianRequested = false;
          await flashPedestrian();
          if (!running) break;
        }

        // Increment cycle count
        cycleCount++;
        cycleCountEl.textContent = cycleCount;
      }

      // Clean up when stopped
      allRed();
      updateStatus('stopped', 'Stopped');
      currentEl.textContent = '‚Äî';
      nextChangeEl.textContent = '‚Äî';
    }

    // Event listeners
    startBtn.onclick = () => {
      if (!running) {
        running = true;
        runTraffic();
      }
    };

    stopBtn.onclick = () => {
      running = false;
    };

    pedBtn.onclick = () => {
      if (running) {
        pedestrianRequested = true;
        showNotification('Pedestrian request registered');
      } else {
        flashPedestrian();
      }
    };

    resetBtn.onclick = () => {
      running = false;
      
      // Reset all values
      cycleCount = 0;
      carsPassed = 0;
      pedestriansCrossed = 0;
      
      cycleCountEl.textContent = cycleCount;
      carsPassedEl.textContent = carsPassed;
      pedestriansCrossedEl.textContent = pedestriansCrossed;
      
      // Reset lights
      allRed();
      updateStatus('stopped', 'Stopped');
      currentEl.textContent = '‚Äî';
      nextChangeEl.textContent = '‚Äî';
      
      // Reset cars
      Object.values(cars).forEach(car => {
        car.classList.remove('moving');
      });
      
      // Reset pedestrians
      Object.values(pedestrians).forEach(ped => {
        ped.classList.remove('active');
      });
      
      showNotification('Simulation reset');
    };

    // Initialize
    allRed();
    updateStatus('stopped', 'Stopped');
  </script>
</body>
</html>
